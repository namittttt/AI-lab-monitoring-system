(self.modernJsonp=self.modernJsonp||[]).push([["4865"],{47755:function(e,t,n){n.d(t,{Z:()=>a});var i=n(681698);function a({url:e,urlParams:t,method:n,data:a,ignoreBookmark:r,callOptions:o,headers:s}){let l=e;return t&&Object.entries(t).forEach(([e,t])=>{let n=`{${e}}`;l.includes(n)&&(l=l.replaceAll(n,encodeURIComponent(String(t))))}),(0,i.Z)({url:l,method:n,data:a,ignoreBookmark:r,callOptions:o,headers:s})}},720459:function(e,t,n){n.d(t,{Z:()=>o});var i=n(24246),a=n(696749);let r=(e,t)=>{let n=t||0,i=10**n,a=+(n?e*i:e).toFixed(8),r=Math.floor(a),o=a-r,s=o>.49999999&&o<.50000001?r%2==0?r:r+1:Math.round(a);return n?s/i:s};function o(){let e=(0,i.Z)();return(t,n,i)=>{let o=0,s=0,l=i&&i.style||void 0,c=i&&i.shortform||!1,d=i&&i.uplimit||void 0,u=i&&i.currency||void 0,m=!!d&&n>=d,p=d&&m?d:n;if("currency"===l){let{minimumFractionDigits:e,maximumFractionDigits:n}=((e,t)=>{if(t){let{minimumFractionDigits:n,maximumFractionDigits:i}=new Intl.NumberFormat(e,{style:"currency",currency:t}).resolvedOptions();if(void 0!==n&&void 0!==i)return{minimumFractionDigits:n,maximumFractionDigits:i}}return{minimumFractionDigits:2,maximumFractionDigits:2}})(t,u);o=void 0===i||void 0===i.maximum_fraction_digits?n:i.maximum_fraction_digits,s=void 0===i||void 0===i.minimum_fraction_digits?e:i.minimum_fraction_digits}else o=void 0===i||void 0===i.maximum_fraction_digits?0:i.maximum_fraction_digits,s=void 0===i||void 0===i.minimum_fraction_digits?0:i.minimum_fraction_digits;if(c&&p>999&&(o=void 0===i||void 0===i.shortform_maximum_fraction_digits?2:i.shortform_maximum_fraction_digits,s=0),o<s)return String(p);let f=p,_="",g=[{"100m":{value:1e8,localeKey:e._('億', 'Abbreviation for one hundred millions. This abbreviation is only used in Chinese, Japanese and Korean.', 'Abbreviation for one hundred millions. This abbreviation is only used in Chinese, Japanese and Korean.')}},{"10k":{value:1e4,localeKey:e._('万', 'Abbreviation for ten thousand. This abbreviation is only used in Chinese, Japanese and Korean.', 'Abbreviation for ten thousand. This abbreviation is only used in Chinese, Japanese and Korean.')}}],y=[{b:{value:1e9,localeKey:e._('b', 'Used in number formatting to abbreviate large values in billions.', 'Abbreviation for one billion.')}},{m:{value:1e6,localeKey:e._('m', 'Used in number formatting to abbreviate large values in millions.', 'Abbreviation for one million.')}},{k:{value:1e3,localeKey:e._('k', 'Used in number formatting to abbreviate large values in thousands.', 'Abbreviation for one thousand.')}}],h=/^zh|ja|ko/.test(t);if(c&&p>999){let e=h?g:y;for(let t=0;t<e.length;t+=1){let n=Object.keys(e[t])[0],i=e[t][n].value;if(p>=i){f=r(p/i*Math.pow(10,o))/Math.pow(10,o),_=e[t][n].localeKey;break}}}if(null==f)return"";let A=f.toLocaleString([(e=>{try{0..toLocaleString([e])}catch(e){return!1}return!0})(t)&&"ar-SA"!==t?t:"en-US"],(({maximumFractionDigits:e,minimumFractionDigits:t,style:n,currency:i})=>{let a={maximumFractionDigits:e,minimumFractionDigits:t};return n?{...a,style:n,..."currency"===n?{currency:i,currencyDisplay:"symbol"}:{}}:a})({maximumFractionDigits:o,minimumFractionDigits:s,currency:u,style:l}));return _&&_.length>0?(0,a.Z)(e._('{{formattedNumber}}{{numberSuffix}}', 'i18n.usePrettyNumberFormat.prettyNumberFormat', 'String used to concatenate formatted number and localized number suffix'),{formattedNumber:A,numberSuffix:_})+(m?"+":""):A+(m?"+":"")}}},169166:function(e,t,n){n.d(t,{Z:()=>i});let i=(0,n(667294).createContext)(null)},506807:function(e,t,n){n.d(t,{Z:()=>i});let i=(0,n(667294).createContext)(null)},495839:function(e,t,n){n.d(t,{Z:()=>Z});var i=n(686659),a=n(667294),r=n(970414),o=n(687412),s=n(774303),l=n(705460),c=n(830031),d=n(267398),u=n(381571),m=n(217472),p=n(780657),f=n(139876),_=n(87980),g=n(240083),y=n(296264),h=n(23641),A=n(774838),T=n(178355),v=n(767415),w=n(785893);let b=["initial_app_load","client_route_push"],S=(0,s.XV)("PwtSurface"),I="NavigationComplete",E="VisuallyComplete",M=()=>{(0,u._T)()},N=e=>{if(e.metricConfig.constraints.every(t=>e.constraintMap[t])){let n=Math.max(...e.metricConfig.constraints.map(t=>e.constraintMap[t])),{metricConfig:{metricId:i,pwtStaticContext:a,annotateExperiments:r},annotations:s,binaryAnnotations:c,constraintMap:m,startTime:p,imageTimings:f,spans:g,traceId:y}=e;(0,h.uj)(`Report_PWT_Complete_${(0,o.KJ)(i)}`,p,n);let A=(0,d.W)({annotateExperiments:[...r??[]],annotations:s,binaryAnnotations:c,constraintMap:m,endTime:n,imageTimings:f,metricId:i,pwtStaticContext:a,startTime:p,traceId:y,spans:g});try{var t=String(A.binaryAnnotationMap["metricId.surface"].value);let e=performance.getEntriesByType("resource").filter(e=>e.name.includes("i.pinimg")).reduce((e,t)=>{let n=t.name.replace(".jpg","").split("/");return{[n[n.length-1]]:{downloadSize:t.name.split("/")[3].split("x")[0]},...e}},{});[...Array.from(document.getElementsByTagName("img")).map(t=>{let n=t.src.replace(".jpg","").split("/"),i=n[n.length-1];if(e[i]){let n=(0,_.rZ)(t)?.width||1,a=e[i].downloadSize;return{fileName:i,renderedSize:n,downloadedSize:a,ratio:a/n}}return{fileName:i,renderedSize:1,downloadedSize:1,ratio:1}}),...Array.from(document.querySelectorAll('div[role="img"]')).map(t=>{let n=t.style.backgroundImage.split('"')[1].replace(".jpg","").split("/"),i=n[n.length-1];if(e[i]&&t instanceof HTMLDivElement){let n=(0,_.rZ)(t)?.width||1,a=e[i].downloadSize;return{fileName:i,renderedSize:n,downloadedSize:a,ratio:a/n}}return{fileName:i,renderedSize:1,downloadedSize:1,ratio:1}})].forEach(e=>{let{ratio:n,fileName:i,downloadedSize:a}=e;e.ratio>1.05&&(0,l.A9)(`checkImageRatio.${t}`,{count:Math.round(10*n)/10,tags:{fileName:`${a}_${i}`}})})}catch(e){(0,l.H)("image_ratio_check_error",{error:e})}return(0,u._T)(),{...e,result:A,status:"DONE"}}return S(`Remaining constraints: ${e.metricConfig.constraints.filter(t=>!e.constraintMap[t]).join(", ")}`),e},C=(e,t)=>{let{constraint:n,time:i}=t,a=(0,o.KJ)(e.metricConfig.metricId);return y.Z?e.metricConfig.constraints.find(e=>e===n)?e.constraintMap[n]?(S(`constraint "${n}" is already complete.`),(0,l.H)("duplicated_constraint_complete",{constraint:n,action:a}),e):(S(`marking constraint "${n}" as complete ${i||performance.now()}`),i?(0,h.Xr)(`constraint_${n}_is_complete`,i):(0,h.Xr)(`constraint_${n}_is_complete`),N({...e,constraintMap:{...e.constraintMap,[n]:i||y.Z.now()}})):(S(`marked constraint "${n}" is not a required constraint.`),e):((0,l.H)("missing_window_performance",{action:a}),e)},P=(e,t)=>{if(S("dispatch action",t),"INIT_ROUTE"===t.type)return((e,t)=>{let{metricConfig:n,startTime:i,isSampled:a,disablePWTLogging:r}=t;if(r||"TIMING"!==e.status||i===e.startTime||M(),!n)return{status:"DISABLED",metricConfig:null};let s=(0,o.KJ)(n.metricId);if("TIMING"===e.status&&e.startTime===i&&e.constraintMap[I])return(0,l.H)("duplicated_init_route_action",{action:s}),e;if(!r){let e=(0,T.H)();(0,l.A9)(`handler.${s}`,{tags:{handler:e}});let t=void 0!==n.metricId.isAuthenticated&&{tags:{isAuth:n.metricId.isAuthenticated}}||void 0;"Other"===n.pwtStaticContext.browserName&&!1===n.metricId.isAuthenticated&&"initial_app_load"===n.metricId.navigationType?((0,l.A9)(`TIMING.${s}`,{tags:{userAgent:window?.navigator?.userAgent}}),(0,l.A9)(`TIMING.sampled.${s}`,{tags:{userAgent:window?.navigator?.userAgent},sampleRate:.03})):((0,l.A9)(`TIMING.${s}`),(0,l.A9)(`TIMING.sampled.${s}`,{sampleRate:.03})),(0,m.C)({resultLog:`TIMING.${s}`,annotateExperiments:n.annotateExperiments||[],getExperimentGroup:n.pwtStaticContext.getExperimentGroup,options:t})}return C({traceId:(0,u.vc)()||(0,u.ZP)("initial_app_load"===n.metricId.navigationType,n.pwtStaticContext.serverData?.trace_id),status:"TIMING",metricConfig:n,startTime:i,constraintMap:{},annotations:{},binaryAnnotations:{},imageTimings:[],isSampled:a,spans:[]},{constraint:I,disablePWTLogging:r})})(e,t.payload);if("TIMING"!==e.status)return S(`ignoring action due to invalid state ${e.status}`,t),e;switch(t.type){case"ABORT":M();let n={type:"ABORT",reason:t.reason};return{...e,status:"DONE",result:n};case"ANNOTATE":let{name:i}=t.payload;if(!y.Z)return e;let a=y.Z.now();return S(`adding annotation {${i}: ${a}}`),{...e,annotations:{...e.annotations,...{[i]:a}}};case"BINARY_ANNOTATE":let{name:r,value:s,annotationType:c}=t.payload;return S(`adding binary annotation {${r}: ${s}}`),{...e,binaryAnnotations:{...e.binaryAnnotations,...{[r]:{value:s,type:c}}}};case"MARK_CONSTRAINT_COMPLETE":return C(e,t.payload);case"REMOVE_CONSTRAINT":return((e,t)=>{if(!y.Z){let t=(0,o.KJ)(e.metricConfig.metricId);(0,l.H)("missing_window_performance",{action:t})}S(`removing constraint "${t}"`);let n=e.metricConfig.constraints.filter(e=>e!==t),{[t]:i,...a}=e.constraintMap;return N({...e,constraintMap:a,metricConfig:{...e.metricConfig,constraints:n}})})(e,t.payload);case"SET_SEGMENT":var d=t.payload;if(!y.Z){let t=(0,o.KJ)(e.metricConfig.metricId);(0,l.H)("missing_window_performance",{action:t})}S(`updating pwt segment to "${d}"`);let p={...e.metricConfig.metricId,segment:d};return{...e,metricConfig:{...e.metricConfig,metricId:p}};case"SET_VISUALLY_COMPLETE_RESULT":{let{payload:{imageTimings:n}}=t;if(0===n.length)return M(),{...e,status:"DONE",result:{type:"ABORT",reason:"visuallyComplete_noImages"}};let i=Math.max(...n.map(e=>e.responseEnd||0));return C({...e,imageTimings:n},{constraint:E,time:i})}case"ADD_SUBSPAN":let{startTime:f}=e,{payload:{name:_,startTime:h,endTime:A,annotations:v,binaryAnnotations:w,parentId:b}}=t;return{...e,spans:[...e.spans,{name:_,id:(0,g.Z)(),startTime:h||f,endTime:A,annotationMap:{...v},binaryAnnotationMap:{...w},parentId:b}]};case"START_SUBSPAN":return{...e,spans:[...e.spans,{name:t.payload.name,id:(0,g.Z)(),startTime:y.Z?y.Z.now():0,endTime:1/0,annotationMap:{...t.payload.annotations},binaryAnnotationMap:{...t.payload.binaryAnnotations},parentId:t.payload.parentId}]};case"STOP_SUBSPAN":let P=e.spans.findIndex(e=>e.name===t.payload.name);return P>-1?(e.spans[P].endTime=y.Z?y.Z.now():0,t.payload.annotations&&(e.spans[P].annotationMap={...e.spans[P].annotationMap,...t.payload.annotations}),t.payload.binaryAnnotations&&(e.spans[P].binaryAnnotationMap={...e.spans[P].binaryAnnotationMap,...t.payload.binaryAnnotations})):(0,l.H)("invalid_subspan_stop_name",{name:t.payload.name}),e;default:let R=(0,o.KJ)(e.metricConfig.metricId);return(0,l.H)("invalid_pwt_surface_action",{action:R}),e}},R=new Set;function Z({children:e,...t}){(0,a.useEffect)(()=>{(0,i.Z)("PwtSurface","/app/packages/pwt-logger/PwtSurface.tsx")},[]);let n=(0,p.Z)(),s=(e=>{if(!e)return"initial_app_load";switch(e.action){case"PUSH":return"client_route_push";case"REPLACE":return"client_route_replace";default:return null}})(n),d=t.measureGridVisuallyComplete?["web_masonry_v2"]:[],u=[...t.annotateExperiments??[],...d],{context:m}=(({surface:e,constraints:t,segment:n,measureGridVisuallyComplete:i,annotateExperiments:o,customEnabledNavigationTypes:s,navigationInfo:{clientNavigation:l,navigationType:c},sampleRate:d})=>{let u=(0,a.useRef)("NOT_SET"),m=(0,f.Z)(),{getState:p,dispatch:_}=((e,t)=>{let n=(0,a.useRef)(t);return{getState:()=>n.current,dispatch:t=>{n.current=e(n.current,t)}}})(P,{status:"DISABLED",metricConfig:null}),g=(0,A.B)();if(u.current!==l&&(u.current=l,m)){let{isAuthenticated:a}=m,r=e&&c&&(s||b).includes(c)?{metricId:{type:"surface",surface:e,navigationType:c,isAuthenticated:a,segment:n},annotateExperiments:o,constraints:[I,...t||[],...i?[E]:[]],pwtStaticContext:m}:null;(0,v.nP)("webapp.pwt_surface.init_route",{tags:{surface:e,navigationType:c,isAuthenticated:a}});let u=!R.has(l);_({type:"INIT_ROUTE",payload:{metricConfig:r,startTime:l?l.time:0,isSampled:!d||Math.random()<d,disablePWTLogging:!u}}),u&&R.add(l)}let h=p();if((0,a.useEffect)(()=>()=>{R.delete(l)},[l]),(0,a.useEffect)(()=>{let e=e=>{_({type:"ABORT",reason:e})};r.Z.onSessionPause(e);let t=window.innerHeight,n=window.innerWidth,i=()=>{let e=Math.abs(window.innerHeight-t),a=Math.abs(window.innerWidth-n),r=window.innerHeight!==t,o=window.innerWidth!==n,s={handler:(0,T.H)(),deviceType:m?.deviceType??"unknown",isAuthenticated:m?.isAuthenticated??"unknown",platform:g.userAgent.platform??"unknown"};if((0,v.nP)("webapp.PwtLogger.handleResize",{sampleRate:1,tags:{...s,heightChanged:r,widthChanged:o}}),r&&(0,v.S0)("webapp.PwtLogger.resizeHeightDelta",e,{sampleRate:1,tags:s}),o&&(0,v.S0)("webapp.PwtLogger.resizeWidthDelta",a,{sampleRate:1,tags:s}),window.removeEventListener("resize",i),m?.deviceType==="phone"&&(!o&&r&&e<=150||!r&&!o)||m?.deviceType==="desktop"&&!r&&!o)return void(0,v.nP)("webapp.PwtLogger.skipResizeAbort",{sampleRate:1,tags:{...s,heightChanged:r,widthChanged:o}});_({type:"ABORT",reason:"windowResized"})};return window.addEventListener("resize",i),()=>{let t=p();S("handling unmount",t),"TIMING"===t.status&&M(),r.Z.removePauseListener(e),window.removeEventListener("resize",i)}},[]),"TIMING"!==h.status||!h.constraintMap[I])return{state:h,context:null};let{startTime:w,metricConfig:N}=h;return{state:h,context:{abort:e=>_({type:"ABORT",reason:e}),addAnnotation:e=>_({type:"ANNOTATE",payload:{name:e}}),addBinaryAnnotation:(e,t,n)=>_({type:"BINARY_ANNOTATE",payload:{name:e,value:t,annotationType:n}}),addSubspan:(e,t,n,i={},a={},r=null)=>_({type:"ADD_SUBSPAN",payload:{name:e,startTime:t,endTime:n,annotations:i,binaryAnnotations:a,parentId:r}}),getId:()=>w,getMetricId:()=>N.metricId,markConstraintComplete:e=>_({type:"MARK_CONSTRAINT_COMPLETE",payload:{constraint:e,time:y.Z?y.Z.now():0}}),removeConstraint:e=>_({type:"REMOVE_CONSTRAINT",payload:e}),setSegment:e=>_({type:"SET_SEGMENT",payload:e}),setVisuallyCompleteResult:N.constraints.includes(E)?e=>_({type:"SET_VISUALLY_COMPLETE_RESULT",payload:e}):null,startSubspan:(e,t={},n={},i=null)=>_({type:"START_SUBSPAN",payload:{name:e,annotations:t,binaryAnnotations:n,parentId:i}}),stopSubspan:(e,t={},n={},i=null)=>_({type:"STOP_SUBSPAN",payload:{name:e,annotations:t,binaryAnnotations:n,parentId:i}})}}})({...t,annotateExperiments:u,navigationInfo:{navigationType:s,clientNavigation:n}}),_=(0,c.A)(),g=!!_;return(0,a.useEffect)(()=>{if(g){let e=_?.getMetricId(),t=e?(0,o.KJ)(e):null;(0,l.H)("nested_pwt_surface",{action:t})}},[g]),(0,w.jsx)(c.S,{value:m,children:e})}},830031:function(e,t,n){n.d(t,{A:()=>a,S:()=>i});let{Provider:i,getMaybe:a}=(0,n(213491).Z)("pwtSurfaceContext")},87980:function(e,t,n){n.d(t,{F9:()=>c,LM:()=>l,VZ:()=>r,cQ:()=>d,rZ:()=>o});var i=n(397345),a=n(705460);let r=()=>"number"==typeof window.innerHeight&&"number"==typeof window.pageYOffset&&!!document.querySelector&&!!document.querySelectorAll,o=e=>e instanceof HTMLDivElement||e instanceof HTMLVideoElement?e.getBoundingClientRect():e.parentElement instanceof HTMLElement?e.parentElement.getBoundingClientRect():null,s=e=>{if(e instanceof HTMLImageElement)return e.src;if(e instanceof HTMLVideoElement)return e.attributes.poster.value;let t=((e.style||{}).backgroundImage||"").match(/^url\(["'](.*)["']\)$/);return t&&t[1]||null},l=()=>document.querySelector?document.querySelectorAll(i.wc).length:((0,a.H)("missing_document_query_selector"),0),c=()=>{let e=(()=>{if(!document.querySelector)return(0,a.H)("missing_document_query_selector"),null;let e=document.querySelectorAll(i.wc);return e[e.length-1]||null})();if(!e)return!1;let t=window.innerHeight||0,n=window.pageYOffset||0;return e.getBoundingClientRect().top+n>=t},d=(e,t,n)=>{if(!document.querySelector)return(0,a.H)("missing_document_query_selector"),[];let r={foldY:window.innerHeight||0,pageYOffset:window.pageYOffset||0},l=[i.Wf,...e?[i.fF]:[],...t?[i.$N]:[]].join(","),c=[...document.querySelectorAll(l)];if(n){let e=[...document.querySelectorAll('div[data-test-id="board-section"]')],t=e=>{let n=[...e.children];!n.length&&e.style.backgroundImage?c.push(e):n.length&&n.forEach(e=>{t(e)})};e.forEach(e=>{t(e)})}return c.reduce((e,n)=>{if((n instanceof HTMLImageElement||n instanceof HTMLDivElement||n instanceof HTMLVideoElement&&t)&&((e,t)=>{let n=o(e);if(!n)return(0,a.H)("missing_client_rect"),!1;if(n.width<70&&n.height<70){if(e instanceof HTMLImageElement)return!1;let t=s(e);if(t?.endsWith("svg"))return!1}return(({top:e,height:t},{foldY:n,pageYOffset:i})=>{let a=e+i;if(a>=n)return!1;let r=Math.min(t,n-a);return r>.5*t||r>.2*n})(n,t)})(n,r)){let t=s(n);if(t){let i=(t||"").replace(/.*\//,"");return e.concat([{element:n,fileName:i}])}}return e},[])}},397345:function(e,t,n){n.d(t,{$N:()=>l,Kb:()=>i,Wf:()=>o,fF:()=>s,wc:()=>r});let i="pwt-grid-item",a=['div[data-grid-item="true"]',"div.Grid__Item",`div[data-test-id="${i}"]`],r=a.join(","),o=a.map(e=>`${e} img`).join(","),s=a.map(e=>`${e} div[style*=background-image]`).join(","),l=a.map(e=>`${e} video`).join(",")},780657:function(e,t,n){n.d(t,{Z:()=>r});var i=n(667294),a=n(169166);function r(){return(0,i.useContext)(a.Z)}},139876:function(e,t,n){n.d(t,{Z:()=>r});var i=n(667294),a=n(506807);function r(){return(0,i.useContext)(a.Z)}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/4865-15b6b18d538c8a97.mjs.map